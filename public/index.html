<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>The Amazing Text Combatotron</title>

    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script> 
    <script src="elm.js"></script>
  </head>
  <body>
    <main></main>
    <script>
      const appElm = Elm.Main.init({ 
        node: document.querySelector('main'), 
        flags: { width: window.innerWidth, height: window.innerHeight }
      });

      appElm.ports.outgoingMessage.subscribe( msg => {
        console.log(msg);
        if (msg.operation == 'Login') {
          fbauth.login(msg.content);
        } else if (msg.operation == 'SignUp') {
          fbauth.signup(msg.content);
        } else if (msg.operation == 'SignOut') {
          fbauth.signout();
        } else {
          console.error("Unrecognized outgoing message.");
        }
      });

      function messageCallback(message) {
        try {
          console.log(message);
          appElm.ports.incomingMessage.send(message);
        }
        catch (error) {
          console.error ("Error in incoming message: ", error.message);
        }
      }

      appElm.ports.saveText.subscribe( text => {
        localStorage.setItem("text", text);
      });
      
      appElm.ports.loadText.subscribe(() => {
        appElm.ports.textLoaded.send(
          localStorage.getItem("text")
        );
      });

    </script>
    <script src="fb-auth.js"></script>
  </body>
</html>